{% extends "base.html" %}

{% block title %}Configurações - Sistema de Gestão Financeira{% endblock %}

{% block page_title %}Configurações{% endblock %}

{% block content %}
<div class="modern-panel">
    <div class="modern-panel-header">
        <h5 class="modern-panel-title">
            <i class="fas fa-cog"></i> Configurações do Sistema
        </h5>
    </div>

    <div style="background:#fff; border: 1px solid #e2e8f0; border-top: none; border-radius: 0 0 10px 10px; padding: 24px;">
        <div class="row g-4">

            <!-- Contas Caixa -->
            <div class="col-md-6 col-lg-4">
                <div class="card h-100" style="border: 1px solid #e2e8f0; border-top: 3px solid #667eea;">
                    <div class="card-body text-center p-4">
                        <div style="width:60px;height:60px;border-radius:14px;background:#ede9fe;display:flex;align-items:center;justify-content:center;margin:0 auto 16px;">
                            <i class="fas fa-university fa-xl" style="color:#667eea;"></i>
                        </div>
                        <h5 class="fw-700 mb-2" style="font-size:1rem;color:#334155;">Contas Caixa</h5>
                        <p class="text-muted mb-4" style="font-size:0.85rem;">Gerencie suas contas bancárias, caixa físico e outros meios de pagamento.</p>
                        <a href="{{ url_for('contas_caixa') }}" class="btn btn-primary w-100">
                            <i class="fas fa-arrow-right me-2"></i>Gerenciar Contas
                        </a>
                    </div>
                </div>
            </div>

            <!-- Perfil -->
            <div class="col-md-6 col-lg-4">
                <div class="card h-100" style="border: 1px solid #e2e8f0; border-top: 3px solid #667eea;">
                    <div class="card-body text-center p-4">
                        <div style="width:60px;height:60px;border-radius:14px;background:#ede9fe;display:flex;align-items:center;justify-content:center;margin:0 auto 16px;">
                            <i class="fas fa-user-cog fa-xl" style="color:#667eea;"></i>
                        </div>
                        <h5 class="fw-700 mb-2" style="font-size:1rem;color:#334155;">Perfil</h5>
                        <p class="text-muted mb-4" style="font-size:0.85rem;">Atualize suas informações pessoais e configurações de conta.</p>
                        <a href="{{ url_for('perfil') }}" class="btn btn-primary w-100">
                            <i class="fas fa-arrow-right me-2"></i>Editar Perfil
                        </a>
                    </div>
                </div>
            </div>

            <!-- Plano de Contas -->
            <div class="col-md-6 col-lg-4">
                <div class="card h-100" style="border: 1px solid #e2e8f0; border-top: 3px solid #667eea;">
                    <div class="card-body text-center p-4">
                        <div style="width:60px;height:60px;border-radius:14px;background:#ede9fe;display:flex;align-items:center;justify-content:center;margin:0 auto 16px;">
                            <i class="fas fa-list-alt fa-xl" style="color:#667eea;"></i>
                        </div>
                        <h5 class="fw-700 mb-2" style="font-size:1rem;color:#334155;">Plano de Contas</h5>
                        <p class="text-muted mb-4" style="font-size:0.85rem;">Configure categorias de entradas e saídas para melhor organização.</p>
                        <a href="{{ url_for('plano_contas') }}" class="btn btn-primary w-100">
                            <i class="fas fa-arrow-right me-2"></i>Gerenciar Categorias
                        </a>
                    </div>
                </div>
            </div>

            <!-- Usuários da Empresa -->
            {% if session.usuario_tipo in ['usuario_principal', 'admin'] %}
            <div class="col-md-6 col-lg-4">
                <div class="card h-100" style="border: 1px solid #e2e8f0; border-top: 3px solid #667eea;">
                    <div class="card-body text-center p-4">
                        <div style="width:60px;height:60px;border-radius:14px;background:#ede9fe;display:flex;align-items:center;justify-content:center;margin:0 auto 16px;">
                            <i class="fas fa-users-cog fa-xl" style="color:#667eea;"></i>
                        </div>
                        <h5 class="fw-700 mb-2" style="font-size:1rem;color:#334155;">Usuários da Empresa</h5>
                        <p class="text-muted mb-4" style="font-size:0.85rem;">Gerencie usuários, permissões e acessos da sua empresa.</p>
                        <a href="{{ url_for('empresa_usuarios') }}" class="btn btn-primary w-100">
                            <i class="fas fa-arrow-right me-2"></i>Gerenciar Usuários
                        </a>
                    </div>
                </div>
            </div>
            {% endif %}

            <!-- Backup Completo -->
            <div class="col-md-6 col-lg-4">
                <div class="card h-100" style="border: 1px solid #e2e8f0; border-top: 3px solid #667eea;">
                    <div class="card-body text-center p-4">
                        <div style="width:60px;height:60px;border-radius:14px;background:#ede9fe;display:flex;align-items:center;justify-content:center;margin:0 auto 16px;">
                            <i class="fas fa-download fa-xl" style="color:#667eea;"></i>
                        </div>
                        <h5 class="fw-700 mb-2" style="font-size:1rem;color:#334155;">Backup Completo</h5>
                        <p class="text-muted mb-4" style="font-size:0.85rem;">Exporte todos os dados do sistema em Excel organizado e bonito.</p>
                        <button type="button" class="btn btn-primary w-100" onclick="exportarBackupGeral()">
                            <i class="fas fa-download me-2"></i>Exportar Backup
                        </button>
                    </div>
                </div>
            </div>

        </div>
    </div>
</div>

<script>
function exportarBackupGeral() {
    const btn = event.target.closest('button');
    const btnOriginal = btn.innerHTML;
    btn.innerHTML = '<i class="fas fa-spinner fa-spin me-2"></i>Gerando Backup...';
    btn.disabled = true;

    const link = document.createElement('a');
    link.href = '/api/backup/exportar-geral';
    link.download = 'backup_completo.xlsx';
    link.style.display = 'none';
    document.body.appendChild(link);
    link.click();
    document.body.removeChild(link);

    setTimeout(() => {
        btn.innerHTML = btnOriginal;
        btn.disabled = false;

        const alertDiv = document.createElement('div');
        alertDiv.className = 'alert alert-success alert-dismissible fade show mt-3';
        alertDiv.innerHTML = `
            <i class="fas fa-check-circle me-2"></i>
            <strong>Backup gerado com sucesso!</strong> O arquivo Excel foi baixado automaticamente.
            <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
        `;
        const container = document.querySelector('.modern-panel');
        container.insertBefore(alertDiv, container.firstChild);
        setTimeout(() => { if (alertDiv.parentNode) alertDiv.remove(); }, 5000);
    }, 2000);
}
</script>
{% endblock %}
